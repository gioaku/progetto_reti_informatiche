SCHEMA DISCOVERY SERVER

select per monitorare arrivo informazioni
se informazioni dal socket {
    ricevo e leggo pacchetto UDP
    se richiesta di connessione {
        invio ack
        aggiungo il peer alla lista di peer connessi
        invio numero di porta del time server
        se primo peer {
            gli invio una lista vuota
        }
        altrimenti {
            cerco i vicini
            compongo la lista da inviare
            la invio
            cerco peer a cui e' cambiata lista di prossimita'
            per ogni vicino {
                compongo lista di prossimita'
                la invio
            }
        }
        aggiorno numero peer connessi
    }
    se richiesta di uscita {
        invio ack
        se ultimo peer
            cancello file peer connessi
        altrimenti {
            elimino peer dalla lista
            cerco peer a cui e' cambiata lista di prossimita'
            per ogni vicino {
                compongo lista di prossimita'
                la invio
            }
        }
    }
    se richiesta numero entries {
        invio ack
        cerco il numero da inviare
        invio risposta con il numero
    }
    se richiesta se risorsa di get occupata {
        invio ack
        invio numero di peer che sta eseguendo la get oppure 0
    }
    se richiesta di lock per get mutuamente esclusiva {
        invio ack
        invio messaggio con autorizzazione o meno ad acquisire mutex
        se nessun peer sta eseguendo qualcosa in mutua esclusione
            memorizzo il numero del peer che sta eseguendo la get
    }
    se richiesta di unlock per get mutuamente esclusiva {
        invio ack
        cancello il numero del peer che stava eseguendo la get
    }
    se richiesta se risorsa di stop occupata {
        invio ack
        invio numero di peer che sta eseguendo la stop oppure 0
    }
    se richiesta di lock per stop mutuamente esclusiva {
        invio ack
        invio messaggio con autorizzazione o meno ad acquisire mutex
        se nessun peer sta eseguendo qualcosa in mutua esclusione
            memorizzo il numero del peer che sta eseguendo la stop
    }
    se richiesta di unlock per stop mutuamente esclusiva {
        invio ack
        cancello il numero del peer che stava eseguendo la stop
    }
    se saluto del timer {
        invio ack
        salvo il numero di porta
    }
}

se informazioni da stdin {
    se help
        stampo i comandi
    se showpeers
        stampo i peer
    se showneighbor {
        stampo i vicini in base a quanti sono
    }
    se esc {
        per ogni peer {
            invio un messaggio di uscita
        }
        cancello file di peer
        spengo il time server
        chiudo il socket
        esco
    }
}
